{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/abstractionjackson/train/schema.json",
    "title": "Train",
    "description": "A resistance workout chronology",
    "type": "object",
    "properties": {
        "workouts": {
            "description": "A Workout Performance Chronology",
            "type": "array",
            "items": {
                "$ref": "#/$defs/workoutPerformance"
            }
        },
        "exercises": {
            "description": "A collection of exercise templates",
            "type": "array",
            "$comment": "Items must have unique displayName values across the array (enforced in application logic).",
            "x-uniqueItemsBy": ["displayName"],
            "items": {
                "$ref": "#/$defs/exerciseTemplate"
            }
        }
    },
    "$defs": {
        "workoutPerformance": {
            "type": "object",
            "required": ["date"],
            "properties": {
                "date": {
                    "description":  "The date on which the workout was performed",
                    "type": "string",
                    "format": "date"
                },
                "intendedExercisePerformance": {
                    "description": "A sequence of intended exercises, in the order they were planned",
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/exercisePerformance"
                    }
                },
                "exercisePerformance": {
                    "description": "An Exercise Performance Chronology",
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/exercisePerformance"
                    }
                }
            }
        },
        "exerciseTemplate": {
            "type": "object",
            "required": ["id", "movement", "position"],
            "properties": {
                "id": {
                    "description": "The unique id of an exercise",
                    "type": "integer"
                },
                "movement": {
                    "description": "The direction against resistance",
                    "type": "string",
                    "enum": ["Push", "Pull"]
                },
                "position": {
                    "description": "The body's spatial orientation",
                    "type": "string",
                    "enum": ["Seated", "Standing", "Kneeling", "Supine", "Prone", "Erect", "Hanging"]
                },
                "equipment": {
                    "description": "The exercise equiptment used, if any",
                    "type": "string",
                    "enum": ["Barbell", "Dumbbells", "Kettlebell", "Cable", "Pulley"]
                },
                "angle": {
                    "description": "Seat back angle in degrees (required when position is Seated)",
                    "type": "number",
                    "enum": [90, 60, 45, 30, 0]
                },
                "aliases": {
                    "description": "Human-readable names that actual gymgoers would use to denote an exercise",
                    "type": "array",
                    "items": { "type": "string" },
                    "uniqueItems": true,
                    "minItems": 1
                },
                "displayName": {
                    "description": "The primary alias",
                    "type": "string"
                }
            },
            "allOf": [
                {
                    "if": {
                        "properties": { "position": { "const": "Seated" } },
                        "required": ["position"]
                    },
                    "then": {
                        "required": ["angle"]
                    }
                }
            ],
            "$comment": "Constraint `displayName is a member of aliases` cannot be expressed in pure draft 2020-12"
        },
        "exercisePerformance": {
            "type": "object",
            "required": ["templateId", "sets", "reps"],
            "properties": {
                "templateId": {
                    "description": "A reference to the exercise performed",
                    "type": "integer"
                },
                "sets": {
                    "description": "A count of the sets performed",
                    "type": "integer",
                    "minimum": 1
                },
                "reps": {
                    "description": "A count of the reps per set",
                    "type": "integer",
                    "minimum": 1
                },
                "weight": {
                    "description": "A number in lbs of the weight, if used",
                    "type": "number",
                    "minimum": 1
                },
                "notes": {
                    "description": "A subjective account from the performer",
                    "type": "string"
                }
            }
        }
    }
}